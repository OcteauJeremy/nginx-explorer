function ConvertJsonToTable(t,e,a,n){var r="<i>{0}</i>",o=e?' id="'+e+'"':"",s=a?' class="'+a+'"':"",c='<table border="1" cellpadding="1" cellspacing="1"'+o+s+">{0}{1}</table>",p="<thead>{0}</thead>",l="<tbody>{0}</tbody>",f="<tr>{0}</tr>",d="<th>{0}</th>",u="<td>{0}</td>",x="",m="",g="";if(t){var h,v="string"==typeof t[0];if(v)x+=d.format("value");else if("object"==typeof t[0])for(h=array_keys(t[0]),i=0;i<h.length;i++)x+=d.format(h[i]);if(p=p.format(f.format(x)),v)for(i=0;i<t.length;i++)m+=u.format(t[i]),g+=f.format(m),m="";else if(h)for(i=0;i<t.length;i++){for(j=0;j<h.length;j++){var b=t[i][h[j]];m+=b?u.format(b):u.format(r.format(b).toUpperCase())}g+=f.format(m),m=""}return l=l.format(g),c=c.format(p,l)}return null}function array_keys(t,e,a){var n="undefined"!=typeof e,i=[],r=!!a,o=!0,s="";if(t&&"object"==typeof t&&t.change_key_case)return t.keys(e,a);for(s in t)t.hasOwnProperty(s)&&(o=!0,n&&(r&&t[s]!==e?o=!1:t[s]!=e&&(o=!1)),o&&(i[i.length]=s));return i}function escapeHtml(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,function(t){return e[t]})}function createDropDown(t){var e=t.parentNode;return e}function fileApp(t,e){loadJSON(t,function(a){formatData(t,a);var n=ConvertJsonToTable(a,null,null,null);if(e.innerHTML="",t!=config.dataset.api){var i=t.lastIndexOf("/",t.length-2),r=t.lastIndexOf("/"),o=t.substring(i+1,r);e.innerHTML=['<h3 style="center;">',escapeHtml(o),"</h3>"].join("")}e.innerHTML+=n;var s=e.getElementsByTagName("th");if(s.length>0){addSortInfo(s);new Tablesort(e.getElementsByTagName("table")[0])}},function(t){console.error(t),e.innerHTML="An error occured"})}function addSortInfo(t){t[0].setAttribute("data-sort-method","default"),t[1].setAttribute("data-sort-method","filesize"),t[2].setAttribute("data-sort-method","date"),t[2].className+="sort-default"}function formatData(t,e){e.forEach(function(e){var a="";a="directory"==e.type?directoryfy(t,e.name):linkify(t,e.name);var n=new Date(e.mtime);n=[n.getDate().padLeft(),(n.getMonth()+1).padLeft(),n.getFullYear()].join("/")+" "+[n.getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft()].join(":");var i="-";e.size&&(i=humanFileSize(e.size,!1)),e.Filename=a,e.Size=i,e.Date=n,delete e.size,delete e.name,delete e.type,delete e.mtime})}function directoryfy(t,e){return['<a href="javascript:void(0)" onclick=\'fileApp("',escapeHtml(t),escapeHtml(e),"/\", createDropDown(this))'>",iconFor(e,!0),e,"</a>"].join("")}function linkify(t,e){return['<a href="',escapeHtml(t),escapeHtml(e),'">',iconFor(e,!1),e,"</a>"].join("")}function humanFileSize(t,e){var a=e?1e3:1024;if(Math.abs(t)<a)return t+" B";var n=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],i=-1;do t/=a,++i;while(Math.abs(t)>=a&&i<n.length-1);return t.toFixed(1)+" "+n[i]}function iconFor(t,e){var a="<img src='/icons/{0}.svg' width=24 class='fileicon'>";if(e)return a.format("folder");var n=t.slice(t.lastIndexOf(".")+1),i="application-octet-stream";return void 0!==IconMap[n]&&(i=IconMap[n]),a.format(i)}function loadJSON(t,e,a){var n=new XMLHttpRequest;n.overrideMimeType("text/html; charset=ISO-8859-1"),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(n.status>=200&&n.status<400?e&&e(JSON.parse(n.responseText)):a&&a(n))},n.open("GET",t,!0),n.send()}String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,a){return"undefined"!=typeof t[a]?t[a]:"{"+a+"}"})},!function(){function t(t,e){if(!t||"TABLE"!==t.tagName)throw new Error("Element must be a table");this.init(t,e||{})}var e=[],a=function(t){var e;return window.CustomEvent&&"function"==typeof window.CustomEvent?e=new CustomEvent(t):(e=document.createEvent("CustomEvent"),e.initCustomEvent(t,!1,!1,void 0)),e},n=function(t){return t.getAttribute("data-sort")||t.textContent||t.innerText||""},i=function(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),t===e?0:e>t?1:-1},r=function(t,e){return function(a,n){var i=t(a.td,n.td);return 0===i?e?n.index-a.index:a.index-n.index:i}};t.extend=function(t,a,n){if("function"!=typeof a||"function"!=typeof n)throw new Error("Pattern and sort must be a function");e.push({name:t,pattern:a,sort:n})},t.prototype={init:function(t,e){var a,n,i,r,o=this;if(o.table=t,o.thead=!1,o.options=e,t.rows&&t.rows.length>0&&(t.tHead&&t.tHead.rows.length>0?(a=t.tHead.rows[t.tHead.rows.length-1],o.thead=!0):a=t.rows[0]),a){var s=function(){o.current&&o.current!==this&&(o.current.classList.remove("sort-up"),o.current.classList.remove("sort-down")),o.current=this,o.sortTable(this)};for(i=0;i<a.cells.length;i++)r=a.cells[i],r.classList.contains("no-sort")||(r.classList.add("sort-header"),r.addEventListener("click",s,!1),r.classList.contains("sort-default")&&(n=r));n&&(o.current=n,o.sortTable(n))}},sortTable:function(t,o){var s=this,c=t.cellIndex,p=i,l="",f=[],d=s.thead?0:1,u=t.getAttribute("data-sort-method");if(s.table.dispatchEvent(a("beforeSort")),!(s.table.rows.length<2)){if(!u){for(;f.length<3&&d<s.table.tBodies[0].rows.length;)l=n(s.table.tBodies[0].rows[d].cells[c]),l=l.trim(),l.length>0&&f.push(l),d++;if(!f)return}for(d=0;d<e.length;d++)if(l=e[d],u){if(l.name===u){p=l.sort;break}}else if(f.every(l.pattern)){p=l.sort;break}s.col=c;var x,m,g=[],h={},v=0,b=0;for(d=0;d<s.table.tBodies.length;d++)for(x=0;x<s.table.tBodies[d].rows.length;x++)l=s.table.tBodies[d].rows[x],l.classList.contains("no-sort")?h[v]=l:g.push({tr:l,td:n(l.cells[s.col]),index:v}),v++;for(o?m=t.classList.contains("sort-up")?"sort-up":"sort-down":(m=t.classList.contains("sort-up")?"sort-down":t.classList.contains("sort-down")?"sort-up":s.options.descending?"sort-up":"sort-down",t.classList.remove("sort-down"===m?"sort-up":"sort-down"),t.classList.add(m)),"sort-down"===m?(g.sort(r(p,!0)),g.reverse()):g.sort(r(p,!1)),d=0;v>d;d++)h[d]?(l=h[d],b++):l=g[d-b].tr,s.table.tBodies[0].appendChild(l);s.table.dispatchEvent(a("afterSort"))}},refresh:function(){void 0!==this.current&&this.sortTable(this.current,!0)}},"undefined"!=typeof module&&module.exports?module.exports=t:window.Tablesort=t}();var config;window.onload=function(){config=document.getElementById("filesapp"),fileApp(config.dataset.api,config)},Number.prototype.padLeft=function(t,e){var a=String(t||10).length-String(this).length+1;return a>0?new Array(a).join(e||"0")+this:this},IconMap={"7z":"application-x-7z-compressed",aac:"audio-x-generic",apk:"android-package-archive",apng:"image-png",atom:"application-atom+xml",avi:"audio-x-generic",bash:"application-x-executable-script",bmp:"image-bmp",c:"text-x-csrc",cfg:"text-x-generic",coffee:"application-x-javascript",conf:"text-x-generic",cpp:"text-x-c++src",csh:"application-x-executable-script",css:"text-css",csv:"text-csv",db:"application-vnd.oasis.opendocument.database",deb:"application-x-deb",desktop:"application-x-desktop",doc:"x-office-document",docx:"x-office-document",eml:"message-rfc822",epub:"application-epub+zip",erb:"application-x-ruby",ex:"text-x-generic",exe:"application-x-executable",fla:"video-x-generic",flac:"audio-x-flac",flv:"video-x-generic",gif:"image-gif",gml:"text-xml",go:"text-x-generic",gpx:"text-xml",gz:"application-x-gzip",h:"text-x-chdr",hxx:"text-x-c++hdr",hs:"text-x-haskell",htm:"text-html",html:"text-html",ico:"image-x-ico",ini:"text-x-generic",iso:"application-x-cd-image",jar:"application-x-java-archive",java:"application-x-java",jpeg:"image-jpeg",jpg:"image-jpeg",js:"application-x-javascript",log:"text-x-generic",lua:"text-x-generic",m3u:"audio-x-generic",markdown:"text-x-generic",md:"text-x-generic",mkv:"video-x-matroska",mp3:"audio-x-mpeg",mp4:"video-mp4",odp:"x-office-presentation",ods:"x-office-spreadsheet",odt:"x-office-document",ogg:"audio-x-generic",otf:"application-x-font-otf",pdf:"application-pdf",pgp:"application-pgp",php:"application-x-php",pkg:"package-x-generic",pl:"application-x-perl",png:"image-png",ppt:"x-office-presentation",pptx:"x-office-presentation",psd:"image-x-psd",py:"text-x-generic",pyc:"application-x-python-bytecode",rar:"application-x-rar",rb:"application-x-ruby",rpm:"application-x-rpm",rtf:"text-rtf",sh:"application-x-executable-script",svg:"image-svg+xml-compressed",svgz:"image-svg+xml-compressed",swf:"application-x-shockwave-flash",tar:"application-x-tar",text:"text-x-generic",tiff:"image-tiff",ttf:"application-x-font-ttf",txt:"text-x-generic",wav:"audio-x-wav",webm:"video-webm",wmv:"video-x-wmv",xcf:"image-x-xcf",xhtml:"text-html",xls:"x-office-spreadsheet",xlsx:"x-office-spreadsheet",xml:"text-xml",xpi:"package-x-generic",xz:"application-x-lzma-compressed-tar",zip:"application-zip",zsh:"application-x-executable-script",opml:"text-xml"},function(){var t=function(t){t=t.replace(/\-/g,"/"),t=t.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3");var e=t.split(" "),a=e[1].split(":"),n=e[0].split("/");return new Date(n[2],n[1]-1,n[0],a[0],a[1],a[2]).getTime()||-1};Tablesort.extend("date",function(e){return(-1!==e.search(/(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\.?\,?\s*/i)||-1!==e.search(/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/)||-1!==e.search(/(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)/i))&&!isNaN(t(e))},function(e,a){return e=e.toLowerCase(),a=a.toLowerCase(),t(e)-t(a)})}(),function(){var t=function(t,e){return t=parseFloat(t),e=parseFloat(e),t=isNaN(t)?0:t,e=isNaN(e)?0:e,t-e},e=function(t){return t.replace(/[^\-?0-9.]/g,"")},a=function(t){var a=t.match(/^(\d+(\.\d+)?) ?((K|M|G|T|P|E|Z|Y|B$)i?B?)$/i),i=parseFloat(e(a[1])),r=a[3];return i*n(r)},n=function(t){t=t.toLowerCase();var e="i"===t[1]?1024:1e3;switch(t[0]){case"b":return Math.pow(e,1);case"k":return Math.pow(e,2);case"m":return Math.pow(e,3);case"g":return Math.pow(e,4);case"t":return Math.pow(e,5);case"p":return Math.pow(e,6);case"e":return Math.pow(e,7);case"z":return Math.pow(e,8);case"y":return Math.pow(e,9);default:return e}};Tablesort.extend("filesize",function(t){return/^\d+(\.\d+)? ?(K|M|G|T|P|E|Z|Y|B$)i?B?$/i.test(t)},function(e,n){return e=""===e?"0 B":e,n=""===n?"0 B":n,e=a(e),n=a(n),t(n,e)})}();